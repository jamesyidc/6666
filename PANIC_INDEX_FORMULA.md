# 恐慌清洗指数计算公式说明

## 📐 正确公式

```
恐慌清洗指数 = (24小时爆仓人数 ÷ 10000) ÷ (全网持仓量 ÷ 1000000000) × 100%
```

**简化表示:**
```
恐慌指数 = (爆仓万人数) / (持仓亿美元) × 100%
```

## 🧮 计算示例

### 示例1：用户提供的真实数据
- **24小时爆仓人数**: 85,431人 = **8.5431万人**
- **全网持仓总计**: $95.79亿
- **计算**: 8.5431 ÷ 95.79 × 100% = **8.92%**

### 示例2：模拟数据验证
- **24小时爆仓人数**: 72,613人 = **7.2613万人**
- **全网持仓总计**: $95.15亿
- **计算**: 7.2613 ÷ 95.15 × 100% = **7.63%**

## 📊 数据指标说明

### 1. 1小时爆仓金额
- **单位**: 美元 (USD)
- **典型范围**: $200万 - $500万
- **说明**: 最近1小时内全网爆仓的总金额

### 2. 24小时爆仓金额
- **单位**: 美元 (USD)
- **典型范围**: $1.5亿 - $2.5亿
- **说明**: 最近24小时内全网爆仓的总金额

### 3. 24小时爆仓人数 ⭐
- **单位**: 人
- **典型范围**: 70,000 - 100,000人（7万-10万人）
- **说明**: 最近24小时内被强制平仓的交易者数量
- **计算用途**: 作为分子，转换为万人单位

### 4. 全网持仓量 ⭐
- **单位**: 美元 (USD)
- **典型范围**: $90亿 - $100亿
- **说明**: 全网未平仓合约的总价值
- **计算用途**: 作为分母，转换为亿美元单位

### 5. 恐慌清洗指数 🔥
- **单位**: 百分比 (%)
- **典型范围**: 7% - 10%
- **说明**: 反映市场恐慌程度的综合指标
- **解读**:
  - **< 5%**: 市场相对稳定
  - **5-8%**: 正常波动范围
  - **8-12%**: 市场恐慌加剧
  - **> 12%**: 极度恐慌，可能出现瀑布行情

## 💻 代码实现

### Python计算示例

```python
def calculate_panic_index(people_24h: int, position_total: float) -> float:
    """
    计算恐慌清洗指数
    
    Args:
        people_24h: 24小时爆仓人数
        position_total: 全网持仓量（美元）
    
    Returns:
        恐慌指数（百分比）
    """
    if position_total <= 0:
        return 0.0
    
    # (万人) / (亿美元) × 100%
    panic_index = (people_24h / 10000) / (position_total / 1e9) * 100
    
    return panic_index

# 示例
people = 85431  # 8.5431万人
position = 95.79e9  # 95.79亿美元
index = calculate_panic_index(people, position)
print(f"恐慌指数: {index:.2f}%")  # 输出: 8.92%
```

### JavaScript前端显示

```javascript
function formatPanicIndex(data) {
    const people_wan = (data.hour_24_people / 10000).toFixed(4);
    const position_yi = (data.total_position / 1e9).toFixed(2);
    const index = data.panic_index.toFixed(2);
    
    return `${index}% (${people_wan}万人 / ${position_yi}亿)`;
}
```

## 📈 历史数据分析

根据我们的数据库记录：

| 时间范围 | 平均爆仓人数 | 平均持仓量 | 平均恐慌指数 |
|---------|------------|-----------|------------|
| 最近1小时 | - | - | - |
| 最近24小时 | 8.5万人 | $95亿 | 8.92% |
| 历史峰值 | 10万人+ | $90亿- | 11%+ |
| 历史低谷 | 7万人- | $100亿+ | 7%- |

## 🎯 应用场景

1. **风险预警**: 当指数>10%时，建议降低杠杆
2. **抄底时机**: 当指数>12%且开始回落时，可能是抄底机会
3. **趋势判断**: 持续上升表明市场恐慌加剧
4. **对比分析**: 结合BTC价格走势，判断市场情绪

## 🔄 更新频率

- **数据采集**: 每3分钟
- **指数计算**: 实时计算
- **数据保存**: 每次采集后立即保存
- **历史保留**: 永久保存所有历史记录

## 📡 API接口

### 获取最新数据
```bash
GET /api/panic-wash/latest
```

### 获取历史数据
```bash
GET /api/panic-wash/history?hours=24
```

### 响应示例
```json
{
    "success": true,
    "data": {
        "hour_1_amount": 3464947.08,
        "hour_24_amount": 173551748.39,
        "hour_24_people": 72613,
        "total_position": 95151586491.36,
        "panic_index": 7.63,
        "record_time": "2025-12-05 11:23:54"
    }
}
```

## ⚠️ 注意事项

1. **数据来源**: https://history.btc123.fans/baocang/
2. **当前模式**: 使用模拟数据（需安装Playwright实现真实爬取）
3. **精度要求**: 百分比保留2位小数
4. **异常处理**: 当持仓量为0时，指数设为0

---

**文档版本**: 1.0  
**最后更新**: 2025-12-05  
**维护者**: GenSpark AI Developer
