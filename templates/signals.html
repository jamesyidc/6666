<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤æ˜“ä¿¡å·ç›‘æ§ - åšå¤šåšç©ºä¿¡å·è¿½è¸ª</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 2rem;
            color: #fff;
        }
        
        .home-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .home-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.5);
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(42, 45, 71, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-value.long {
            color: #10b981;
        }
        
        .stat-value.short {
            color: #ef4444;
        }
        
        .stat-value.neutral {
            color: #00d4ff;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-section {
            background: rgba(42, 45, 71, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.5rem;
            color: #fff;
        }
        
        .chart-controls {
            display: flex;
            gap: 10px;
        }
        
        .chart-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .chart-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .chart-btn.active {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            border-color: transparent;
        }
        
        #signalChart {
            width: 100%;
            height: 500px;
        }
        
        /* åˆ†é¡µæ§åˆ¶ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .page-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .page-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .page-info {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
        }
        
        /* å†å²æ•°æ®è¡¨æ ¼ */
        .history-section {
            background: rgba(42, 45, 71, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .history-table th {
            background: rgba(0, 0, 0, 0.3);
            color: #00d4ff;
            font-weight: 600;
        }
        
        .history-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .long-text {
            color: #10b981;
            font-weight: 600;
        }
        
        .short-text {
            color: #ef4444;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="top-nav">
            <h1 class="page-title">ğŸ“Š äº¤æ˜“ä¿¡å·ç›‘æ§</h1>
            <a href="/" class="home-btn">ğŸ  è¿”å›é¦–é¡µ</a>
        </div>
        
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">æœ€æ–°åšå¤šä¿¡å·</div>
                <div class="stat-value long" id="latestLong">-</div>
                <div class="stat-label" id="longRatio">å æ¯”: -</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æœ€æ–°åšç©ºä¿¡å·</div>
                <div class="stat-value short" id="latestShort">-</div>
                <div class="stat-label" id="shortRatio">å æ¯”: -</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æ€»ä¿¡å·æ•°</div>
                <div class="stat-value neutral" id="totalSignals">-</div>
                <div class="stat-label" id="updateTime">æ›´æ–°æ—¶é—´: -</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æ•°æ®è®°å½•</div>
                <div class="stat-value neutral" id="totalRecords">-</div>
                <div class="stat-label">å†å²æ•°æ®ç‚¹</div>
            </div>
        </div>
        
        <!-- å›¾è¡¨åŒºåŸŸ -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">ğŸ“ˆ ä¿¡å·è¶‹åŠ¿å›¾ (12å°æ—¶)</h2>
                <div class="chart-controls">
                    <button class="chart-btn" onclick="changeTimeRange('1h')">1å°æ—¶</button>
                    <button class="chart-btn" onclick="changeTimeRange('6h')">6å°æ—¶</button>
                    <button class="chart-btn active" onclick="changeTimeRange('12h')">12å°æ—¶</button>
                    <button class="chart-btn" onclick="changeTimeRange('24h')">24å°æ—¶</button>
                </div>
            </div>
            <div id="signalChart"></div>
            <div class="pagination">
                <button class="page-btn" id="prevPage" onclick="changePage(-1)">â† ä¸Šä¸€é¡µ</button>
                <span class="page-info" id="pageInfo">ç¬¬ 1 é¡µ</span>
                <button class="page-btn" id="nextPage" onclick="changePage(1)">ä¸‹ä¸€é¡µ â†’</button>
            </div>
        </div>
        
        <!-- å†å²æ•°æ®è¡¨æ ¼ -->
        <div class="history-section">
            <h2 class="chart-title">ğŸ“‹ å†å²è®°å½• (æœ€è¿‘50æ¡)</h2>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>è®°å½•æ—¶é—´</th>
                        <th>åšå¤šä¿¡å·</th>
                        <th>åšç©ºä¿¡å·</th>
                        <th>æ€»ä¿¡å·</th>
                        <th>åšå¤šå æ¯”</th>
                        <th>åšç©ºå æ¯”</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                    <tr><td colspan="6">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        let chart = null;
        let currentPage = 0;
        let currentTimeRange = '12h';
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            chart = echarts.init(document.getElementById('signalChart'));
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: '#00d4ff',
                    textStyle: { color: '#fff' }
                },
                legend: {
                    data: ['åšå¤šä¿¡å·', 'åšç©ºä¿¡å·'],
                    textStyle: { color: '#fff' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: 60,
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: [],
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.7)' }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.7)' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }
                },
                series: [
                    {
                        name: 'åšå¤šä¿¡å·',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        itemStyle: { color: '#10b981' },
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(16, 185, 129, 0.3)' },
                                    { offset: 1, color: 'rgba(16, 185, 129, 0.05)' }
                                ]
                            }
                        },
                        data: []
                    },
                    {
                        name: 'åšç©ºä¿¡å·',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        itemStyle: { color: '#ef4444' },
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(239, 68, 68, 0.3)' },
                                    { offset: 1, color: 'rgba(239, 68, 68, 0.05)' }
                                ]
                            }
                        },
                        data: []
                    }
                ]
            };
            chart.setOption(option);
        }
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                // åŠ è½½å›¾è¡¨æ•°æ®
                const chartResponse = await fetch(`/api/signals/chart?page=${currentPage}&range=${currentTimeRange}`);
                const chartData = await chartResponse.json();
                
                if (chartData.success) {
                    updateChart(chartData.data);
                    updatePagination(chartData.page, chartData.total_pages);
                }
                
                // åŠ è½½ç»Ÿè®¡æ•°æ®
                const statsResponse = await fetch('/api/signals/stats');
                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    updateStats(statsData.data);
                }
                
                // åŠ è½½å†å²è®°å½•
                const historyResponse = await fetch('/api/signals/history?limit=50');
                const historyData = await historyResponse.json();
                
                if (historyData.success) {
                    updateHistory(historyData.data);
                }
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateChart(data) {
            const times = data.map(d => d.time);
            const longSignals = data.map(d => d.long_signals);
            const shortSignals = data.map(d => d.short_signals);
            
            chart.setOption({
                xAxis: { data: times },
                series: [
                    { data: longSignals },
                    { data: shortSignals }
                ]
            });
        }
        
        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        function updateStats(data) {
            document.getElementById('latestLong').textContent = data.latest_long || 0;
            document.getElementById('latestShort').textContent = data.latest_short || 0;
            document.getElementById('totalSignals').textContent = data.latest_total || 0;
            document.getElementById('totalRecords').textContent = data.total_records || 0;
            document.getElementById('longRatio').textContent = `å æ¯”: ${data.long_ratio || 0}%`;
            document.getElementById('shortRatio').textContent = `å æ¯”: ${data.short_ratio || 0}%`;
            document.getElementById('updateTime').textContent = `æ›´æ–°: ${data.latest_time || '-'}`;
        }
        
        // æ›´æ–°å†å²è®°å½•è¡¨æ ¼
        function updateHistory(data) {
            const tbody = document.getElementById('historyBody');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">æš‚æ— æ•°æ®</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.map(record => `
                <tr>
                    <td>${record.record_time}</td>
                    <td class="long-text">${record.long_signals}</td>
                    <td class="short-text">${record.short_signals}</td>
                    <td>${record.total_signals}</td>
                    <td class="long-text">${record.long_ratio}%</td>
                    <td class="short-text">${record.short_ratio}%</td>
                </tr>
            `).join('');
        }
        
        // æ›´æ–°åˆ†é¡µä¿¡æ¯
        function updatePagination(current, total) {
            document.getElementById('pageInfo').textContent = `ç¬¬ ${current + 1} / ${total} é¡µ`;
            document.getElementById('prevPage').disabled = current === 0;
            document.getElementById('nextPage').disabled = current >= total - 1;
        }
        
        // ç¿»é¡µ
        function changePage(delta) {
            currentPage += delta;
            loadData();
        }
        
        // åˆ‡æ¢æ—¶é—´èŒƒå›´
        function changeTimeRange(range) {
            currentTimeRange = range;
            currentPage = 0;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadData();
        }
        
        // åˆå§‹åŒ–
        window.onload = function() {
            initChart();
            loadData();
            
            // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®
            setInterval(loadData, 30000);
        };
        
        // å“åº”å¼å›¾è¡¨
        window.onresize = function() {
            if (chart) {
                chart.resize();
            }
        };
    </script>
</body>
</html>
