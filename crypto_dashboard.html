<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ å¯†è´§å¸æ•°æ®ç›‘æ§é¢æ¿ v7.1 - é¦–æ¬¡é«˜äº®ä¼˜åŒ–</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Chart.js å›¾è¡¨åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, "Microsoft YaHei", sans-serif;
            background-color: #f5f5f5;
            font-size: 12px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
            background-color: white;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  - å·²éšè— */
        .navbar {
            display: none;
        }

        /* å›¾è¡¨åŒºåŸŸ */
        .chart-container {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            margin-bottom: 10px;
        }

        /* é¡¶éƒ¨ç»Ÿè®¡åŒºåŸŸ */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 5px 10px;
        }

        .stat-label {
            color: #666;
            font-weight: bold;
        }

        .stat-value {
            color: #333;
            font-weight: bold;
        }

        .star {
            color: #ffd700;
        }

        /* åº•éƒ¨ç»Ÿè®¡æ  */
        .bottom-stats {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 11px;
        }

        .data-table th,
        .data-table td {
            border: 1px solid #ddd;
            padding: 6px 4px;
            text-align: center;
        }

        .data-table th {
            background-color: #e9ecef;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tr:hover {
            background-color: #f8f9fa;
        }

        /* é¢œè‰²æ ‡è¯† */
        .green-cell {
            background-color: #00ff00 !important;
            color: black;
            font-weight: bold;
        }
        
        /* æœ€é«˜å æ¯”è¡Œé«˜äº® */
        .max-ratio-row {
            background-color: #ccffcc !important;
        }
        
        .max-ratio-row:hover {
            background-color: #b3ffb3 !important;
        }

        .red-cell {
            background-color: #ff0000 !important;
            color: white;
            font-weight: bold;
        }

        .yellow-cell {
            background-color: #ffff00 !important;
            color: black;
            font-weight: bold;
        }

        /* æ›´æ–°æ—¶é—´æ˜¾ç¤º */
        .update-time {
            text-align: center;
            padding: 10px;
            color: #666;
            font-size: 12px;
        }

        /* åŠ è½½æç¤º */
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 50px;
            font-size: 16px;
            color: #dc3545;
        }

        /* è‡ªåŠ¨åˆ·æ–°å€’è®¡æ—¶ */
        .refresh-countdown {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .data-table {
                font-size: 10px;
            }
            
            .data-table th,
            .data-table td {
                padding: 4px 2px;
            }
        }
    </style>
</head>
<body>
    <!-- è‡ªåŠ¨åˆ·æ–°å€’è®¡æ—¶ -->
    <div class="refresh-countdown" id="countdown">
        ä¸‹æ¬¡æ›´æ–°: <span id="countdown-time">10:00</span>
    </div>

    <div class="container">
        <!-- å¯¼èˆªæ  -->
        <div class="navbar">
            <a href="#" class="active">é¦–é¡µ</a>
            <a href="#">æŸ¥è¯¢</a>
            <a href="#">æŒ‚å·</a>
            <a href="#">æ¯”ä»·</a>
            <a href="#">è¿½æ¶¨æ¯”ä»·</a>
            <a href="#">ç›˜æ§</a>
            <a href="#">é‡ç‚¹ç›˜æ§</a>
            <a href="#">æŸ¥è¯¢</a>
            <a href="#">å·¥å…·</a>
        </div>

        <!-- é¡¶éƒ¨ç»Ÿè®¡æ  -->
        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-label">æ€¥æ¶¨ï¼š</span>
                <span class="stat-value" id="stat-rush-up">15</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æ€¥è·Œï¼š</span>
                <span class="stat-value" id="stat-rush-down">4</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">çŠ¶æ€ï¼š</span>
                <span class="stat-value" id="stat-status">éœ‡è¡æ— åº</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æ¯”å€¼ï¼š</span>
                <span class="stat-value" id="stat-ratio">2.75</span>
                <span class="star">â˜…â˜…</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ç»¿è‰²æ•°é‡ï¼š</span>
                <span class="stat-value" id="stat-green-count">27</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ç™¾åˆ†æ¯”ï¼š</span>
                <span class="stat-value" id="stat-percentage">93%</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">è®¡æ¬¡ï¼š</span>
                <span class="stat-value" id="stat-count">7</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">å·®å€¼ï¼š</span>
                <span class="stat-value" id="stat-diff">11</span>
                <span class="star">â˜…â˜…</span>
            </div>
        </div>

        <!-- æ€¥æ¶¨æ€¥è·Œè¶‹åŠ¿å›¾è¡¨ -->
        <div class="chart-container">
            <div class="chart-title">ğŸ“Š æ€¥æ¶¨æ€¥è·Œè¶‹åŠ¿ç»Ÿè®¡</div>
            <div class="chart-wrapper">
                <canvas id="rushChart"></canvas>
            </div>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div id="table-container">
            <div class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
        </div>

        <!-- åº•éƒ¨ç»Ÿè®¡æ  -->
        <div class="bottom-stats">
            <div class="stat-item">
                <span class="stat-label">é£æ§é¢„è­¦ï¼š</span>
                <span class="stat-value" id="bottom-stat-1">30 60åˆ† 40%ç»¼åˆ: 0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æ›´æ–°æ—¶é—´ï¼š</span>
                <span class="stat-value" id="bottom-stat-2">2025å¹´12æœˆ2æ—¥ 18æ—¶06åˆ†44ç§’</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">å…¨ç»¿0%ï¼š</span>
                <span class="stat-value" id="bottom-stat-3">30 7</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æ¯”ä»·æœ€ä½ï¼š</span>
                <span class="stat-value" id="bottom-stat-4">0 0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æ€¥è·Œæ•°é‡ï¼š</span>
                <span class="stat-value" id="bottom-stat-5">è®¡æ¬¡ 0 4</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æ¯”ä»·åˆ›æ–°é«˜ï¼š</span>
                <span class="stat-value" id="bottom-stat-6">0 0</span>
            </div>
        </div>

        <!-- æ›´æ–°æ—¶é—´ -->
        <div class="update-time" id="update-time">
            æœ€åæ›´æ–°: --
        </div>
    </div>

    <script>
        // é…ç½®
        const API_URL = '/api/crypto-data';
        const REFRESH_INTERVAL = 10 * 60 * 1000; // 10åˆ†é’Ÿ
        let countdownInterval;
        let refreshTimeout;
        let rushChart = null;

        // å†å²æ•°æ®å­˜å‚¨ï¼ˆæœ€å¤šä¿ç•™50ä¸ªæ•°æ®ç‚¹ï¼‰
        let historyData = {
            timestamps: [],
            rushUp: [],
            rushDown: [],
            diff: [],
            count: []  // æ·»åŠ è®¡æ¬¡
        };
        
        // æ–‡ä»¶æ›´æ–°æ—¶é—´ï¼ˆç”¨äºè®¡ç®—å€’è®¡æ—¶ï¼‰
        let lastFileTime = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            loadHistoryData();
            loadData();
            startCountdown();
        });

        // åŠ è½½å†å²æ•°æ®
        async function loadHistoryData() {
            try {
                console.log('æ­£åœ¨åŠ è½½å†å²æ•°æ®...');
                const response = await fetch('/api/history-chart');
                const result = await response.json();
                
                if (result.success && result.history && result.history.length > 0) {
                    console.log(`åŠ è½½åˆ° ${result.history.length} ä¸ªå†å²æ•°æ®ç‚¹`);
                    
                    // å¡«å……å†å²æ•°æ®ï¼ˆç›´æ¥ä½¿ç”¨TXTæ–‡ä»¶ä¸­çš„ç´¯è®¡å€¼ï¼‰
                    result.history.forEach((item, index) => {
                        const rushUp = parseInt(item.rushUp) || 0;      // TXTæ–‡ä»¶ä¸­çš„æ€¥æ¶¨ç´¯è®¡å€¼
                        const rushDown = parseInt(item.rushDown) || 0;  // TXTæ–‡ä»¶ä¸­çš„æ€¥è·Œç´¯è®¡å€¼
                        const count = parseInt(item.count) || 0;        // TXTæ–‡ä»¶ä¸­çš„è®¡æ¬¡ç´¯è®¡å€¼
                        const diff = rushUp - rushDown;                 // å‰ç«¯è®¡ç®—å·®å€¼
                        
                        historyData.timestamps.push(item.time);
                        historyData.rushUp.push(rushUp);
                        historyData.rushDown.push(rushDown);
                        historyData.diff.push(diff);
                        historyData.count.push(count);  // æ·»åŠ è®¡æ¬¡
                        
                        // è®°å½•æœ€åä¸€ä¸ªæ–‡ä»¶çš„æ—¶é—´
                        if (index === result.history.length - 1 && item.timestamp) {
                            lastFileTime = new Date(item.timestamp);
                            console.log('æœ€åæ–‡ä»¶æ—¶é—´:', lastFileTime);
                        }
                    });
                    
                    // æ›´æ–°å›¾è¡¨ï¼ˆåŒ…å«å·®å€¼å’Œè®¡æ¬¡ï¼‰
                    if (rushChart) {
                        rushChart.data.labels = historyData.timestamps;
                        rushChart.data.datasets[0].data = historyData.rushUp;
                        rushChart.data.datasets[1].data = historyData.rushDown;
                        rushChart.data.datasets[2].data = historyData.diff;
                        rushChart.data.datasets[3].data = historyData.count;  // æ·»åŠ è®¡æ¬¡æ•°æ®
                        
                        // æ ‡è®°é‡ç‚¹æ•°æ®
                        updatePointStyles();
                        
                        rushChart.update();
                    }
                    
                    console.log('å†å²æ•°æ®åŠ è½½å®Œæˆ');
                } else {
                    console.log('æ²¡æœ‰å†å²æ•°æ®');
                }
            } catch (error) {
                console.error('åŠ è½½å†å²æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°æ•°æ®ç‚¹æ ·å¼ï¼ˆæ ‡è®°é‡ç‚¹ï¼‰
        // åªåœ¨ã€ç¬¬ä¸€æ¬¡ã€‘æ»¡è¶³æ¡ä»¶æ—¶é«˜äº®ï¼Œä¹‹åå³ä½¿ç»§ç»­æ»¡è¶³ä¹Ÿä¸å†é«˜äº®
        function updatePointStyles() {
            if (!rushChart) return;
            
            const rushUpColors = [];
            const rushDownColors = [];
            const diffColors = [];
            const rushUpSizes = [];
            const rushDownSizes = [];
            const diffSizes = [];
            
            // æ ‡è®°æ˜¯å¦å·²ç»é«˜äº®è¿‡
            let rushUpHighlighted = false;
            let rushDownHighlighted = false;
            let diffHighlighted = false;
            
            for (let i = 0; i < historyData.rushUp.length; i++) {
                const rushUp = historyData.rushUp[i];
                const rushDown = historyData.rushDown[i];
                const diff = historyData.diff[i];
                
                // æ€¥æ¶¨æ ‡è®°ï¼ˆåªåœ¨ç¬¬ä¸€æ¬¡â‰¥10æ—¶é«˜äº®ï¼‰
                if (rushUp >= 10 && !rushUpHighlighted) {
                    rushUpColors.push('#00ff00');  // äº®ç»¿è‰²é«˜äº®
                    rushUpSizes.push(10);
                    rushUpHighlighted = true;  // æ ‡è®°å·²é«˜äº®ï¼Œåç»­ä¸å†é«˜äº®
                } else {
                    rushUpColors.push('rgba(0, 204, 0, 0.6)');  // åŠé€æ˜ç»¿è‰²
                    rushUpSizes.push(4);
                }
                
                // æ€¥è·Œæ ‡è®°ï¼ˆåªåœ¨ç¬¬ä¸€æ¬¡â‰¥10æ—¶é«˜äº®ï¼‰
                if (rushDown >= 10 && !rushDownHighlighted) {
                    rushDownColors.push('#ff0000');  // äº®çº¢è‰²é«˜äº®
                    rushDownSizes.push(10);
                    rushDownHighlighted = true;  // æ ‡è®°å·²é«˜äº®ï¼Œåç»­ä¸å†é«˜äº®
                } else {
                    rushDownColors.push('rgba(204, 0, 0, 0.6)');  // åŠé€æ˜çº¢è‰²
                    rushDownSizes.push(4);
                }
                
                // å·®å€¼æ ‡è®°ï¼ˆåªåœ¨ç¬¬ä¸€æ¬¡â‰¥50æˆ–â‰¤-50æ—¶é«˜äº®ï¼‰
                if ((diff >= 50 || diff <= -50) && !diffHighlighted) {
                    diffColors.push('#ff6600');  // æ©™è‰²é«˜äº®
                    diffSizes.push(10);
                    diffHighlighted = true;  // æ ‡è®°å·²é«˜äº®ï¼Œåç»­ä¸å†é«˜äº®
                } else {
                    diffColors.push('#0080ff');  // è“è‰²å¸¸è§„
                    diffSizes.push(4);
                }
            }
            
            rushChart.data.datasets[0].pointBackgroundColor = rushUpColors;
            rushChart.data.datasets[0].pointRadius = rushUpSizes;
            rushChart.data.datasets[1].pointBackgroundColor = rushDownColors;
            rushChart.data.datasets[1].pointRadius = rushDownSizes;
            rushChart.data.datasets[2].pointBackgroundColor = diffColors;
            rushChart.data.datasets[2].pointRadius = diffSizes;
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            const ctx = document.getElementById('rushChart').getContext('2d');
            rushChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'æ€¥æ¶¨',
                            data: [],
                            borderColor: '#00ff00',
                            backgroundColor: 'rgba(0, 255, 0, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'æ€¥è·Œ',
                            data: [],
                            borderColor: '#ff0000',
                            backgroundColor: 'rgba(255, 0, 0, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'å·®å€¼(æ€¥æ¶¨-æ€¥è·Œ)',
                            data: [],
                            borderColor: '#0080ff',
                            backgroundColor: 'rgba(0, 128, 255, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'è®¡æ¬¡',
                            data: [],
                            borderColor: '#ff00ff',
                            backgroundColor: 'rgba(255, 0, 255, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                title: function(context) {
                                    return 'æ—¶é—´: ' + context[0].label;
                                },
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            position: 'left',
                            ticks: {
                                stepSize: 2
                            },
                            title: {
                                display: true,
                                text: 'æ€¥æ¶¨/æ€¥è·Œæ•°é‡'
                            }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            title: {
                                display: true,
                                text: 'å·®å€¼ / è®¡æ¬¡'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'æ›´æ–°æ—¶é—´'
                            },
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        // æ›´æ–°å›¾è¡¨æ•°æ®
        function updateChart(stats, fileTime) {
            if (!rushChart) return;

            // ä½¿ç”¨æ–‡ä»¶æ—¶é—´æˆ³+1åˆ†é’Ÿä½œä¸ºæ›´æ–°æ—¶é—´
            let timeStr;
            if (fileTime) {
                const fileDate = new Date(fileTime);
                fileDate.setMinutes(fileDate.getMinutes() + 1);  // æ–‡ä»¶æ—¶é—´+1åˆ†é’Ÿ
                timeStr = fileDate.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
                lastFileTime = fileDate;
                console.log(`æ–‡ä»¶æ—¶é—´: ${fileTime}, æ›´æ–°æ—¶é—´(+1åˆ†é’Ÿ): ${timeStr}`);
            } else {
                const now = new Date();
                timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰è¿™ä¸ªæ—¶é—´ç‚¹çš„æ•°æ®ï¼ˆé¿å…é‡å¤ï¼‰
            const lastTime = historyData.timestamps[historyData.timestamps.length - 1];
            if (lastTime === timeStr) {
                console.log('æ•°æ®ç‚¹å·²å­˜åœ¨ï¼Œè·³è¿‡æ›´æ–°');
                return;
            }
            
            // è®¡ç®—å·®å€¼
            const rushUp = parseInt(stats.rushUp) || 0;
            const rushDown = parseInt(stats.rushDown) || 0;
            const count = parseInt(stats.count) || 0;  // è®¡æ¬¡
            const diff = rushUp - rushDown;
            
            // æ·»åŠ æ–°æ•°æ®
            historyData.timestamps.push(timeStr);
            historyData.rushUp.push(rushUp);
            historyData.rushDown.push(rushDown);
            historyData.diff.push(diff);
            historyData.count.push(count);  // æ·»åŠ è®¡æ¬¡

            console.log(`æ·»åŠ æ–°æ•°æ®ç‚¹: ${timeStr}, æ€¥æ¶¨:${rushUp}, æ€¥è·Œ:${rushDown}, å·®å€¼:${diff}, è®¡æ¬¡:${count}`);

            // ä¿æŒæœ€å¤š50ä¸ªæ•°æ®ç‚¹ï¼ˆæ˜¾ç¤ºæ›´é•¿çš„å†å²ï¼‰
            if (historyData.timestamps.length > 50) {
                historyData.timestamps.shift();
                historyData.rushUp.shift();
                historyData.rushDown.shift();
                historyData.diff.shift();
                historyData.count.shift();  // æ·»åŠ è®¡æ¬¡
            }

            // æ›´æ–°å›¾è¡¨
            rushChart.data.labels = historyData.timestamps;
            rushChart.data.datasets[0].data = historyData.rushUp;
            rushChart.data.datasets[1].data = historyData.rushDown;
            rushChart.data.datasets[2].data = historyData.diff;
            rushChart.data.datasets[3].data = historyData.count;  // æ·»åŠ è®¡æ¬¡æ•°æ®
            
            // æ›´æ–°æ ‡è®°
            updatePointStyles();
            
            rushChart.update();
        }

        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                if (data.success) {
                    renderData(data.data);
                    updateStats(data.stats);
                    // ä¼ å…¥æ–‡ä»¶æ›´æ–°æ—¶é—´ï¼ˆç”¨äºè®¡ç®—TXTæ—¶é—´+1åˆ†é’Ÿï¼‰
                    updateChart(data.stats, data.updateTime);
                    updateUpdateTime(data.updateTime);
                    
                    // é‡æ–°è®¡ç®—å€’è®¡æ—¶ï¼ˆåŸºäºæ–‡ä»¶æ—¶é—´+1åˆ†é’Ÿï¼‰
                    if (data.updateTime) {
                        resetCountdown(data.updateTime);
                    }
                } else {
                    showError(data.error || 'æ•°æ®åŠ è½½å¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®é”™è¯¯:', error);
                showError('æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨');
            }

            // è®¾ç½®ä¸‹æ¬¡è‡ªåŠ¨åˆ·æ–°
            clearTimeout(refreshTimeout);
            refreshTimeout = setTimeout(loadData, REFRESH_INTERVAL);
        }

        // æ¸²æŸ“æ•°æ®è¡¨æ ¼
        function renderData(data) {
            const container = document.getElementById('table-container');
            
            // æ‰¾å‡ºratio1ï¼ˆç›˜ç‚¹å æ¯”ï¼‰æœ€é«˜çš„è¡Œ
            let maxRatio1 = -Infinity;
            let maxRatio1Symbol = '';
            data.forEach(row => {
                const ratio1Value = parseFloat(row.ratio1);
                if (!isNaN(ratio1Value) && ratio1Value > maxRatio1) {
                    maxRatio1 = ratio1Value;
                    maxRatio1Symbol = row.symbol;
                }
            });
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>å¸å</th>
                            <th>æ¶¨å¹…</th>
                            <th>æ€¥æ¶¨</th>
                            <th>æ€¥è·Œ</th>
                            <th>æ›´æ–°æ—¶é—´</th>
                            <th>å†å²é«˜ä»·</th>
                            <th>é«˜ä»·æ—¶é—´</th>
                            <th>è·Œå¹…</th>
                            <th>24å°æ—¶</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th>æ’è¡Œ</th>
                            <th>å½“å‰ä»·æ ¼</th>
                            <th>ç›˜ç‚¹å æ¯”</th>
                            <th>æœ€ä½å æ¯”</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach((row, index) => {
                const changeClass = getChangeClass(parseFloat(row.change));
                // å¦‚æœæ˜¯æœ€é«˜ç›˜ç‚¹å æ¯”çš„è¡Œï¼Œæ·»åŠ ç»¿è‰²é«˜äº®
                const isMaxRatio = row.symbol === maxRatio1Symbol;
                const rowClass = isMaxRatio ? 'class="max-ratio-row"' : '';
                
                html += `
                    <tr ${rowClass}>
                        <td>${index + 1}</td>
                        <td><strong>${row.symbol}</strong></td>
                        <td class="${changeClass}">${row.change}</td>
                        <td>${row.rushUp}</td>
                        <td>${row.rushDown}</td>
                        <td>${row.updateTime}</td>
                        <td>${row.highPrice}</td>
                        <td>${row.highTime}</td>
                        <td>${row.decline}</td>
                        <td>${row.change24h}</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td>${row.rank}</td>
                        <td>${row.currentPrice}</td>
                        <td>${row.ratio1}</td>
                        <td>${row.ratio2}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            container.innerHTML = html;
        }

        // è·å–æ¶¨è·Œé¢œè‰²ç±»
        function getChangeClass(change) {
            if (change > 0.3) return 'green-cell';
            if (change < -0.05) return 'red-cell';
            if (change >= 0.2) return 'yellow-cell';
            return '';
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats(stats) {
            if (!stats) return;
            
            document.getElementById('stat-rush-up').textContent = stats.rushUp || '15';
            document.getElementById('stat-rush-down').textContent = stats.rushDown || '4';
            document.getElementById('stat-status').textContent = stats.status || 'éœ‡è¡æ— åº';
            document.getElementById('stat-ratio').textContent = stats.ratio || '2.75';
            document.getElementById('stat-green-count').textContent = stats.greenCount || '27';
            document.getElementById('stat-percentage').textContent = stats.percentage || '93%';
            document.getElementById('stat-count').textContent = stats.count || '7';
            document.getElementById('stat-diff').textContent = stats.diff || '11';
        }

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateUpdateTime(time) {
            const element = document.getElementById('update-time');
            element.textContent = `æœ€åæ›´æ–°: ${time || new Date().toLocaleString('zh-CN')}`;
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            const container = document.getElementById('table-container');
            container.innerHTML = `<div class="error">${message}</div>`;
        }

        // å€’è®¡æ—¶
        function startCountdown() {
            let seconds = 600; // 10åˆ†é’Ÿ = 600ç§’

            function updateCountdown() {
                const minutes = Math.floor(seconds / 60);
                const secs = seconds % 60;
                const display = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                document.getElementById('countdown-time').textContent = display;

                if (seconds === 0) {
                    seconds = 600;
                } else {
                    seconds--;
                }
            }

            updateCountdown();
            clearInterval(countdownInterval);
            countdownInterval = setInterval(updateCountdown, 1000);
        }
        
        // é‡ç½®å€’è®¡æ—¶ï¼ˆåŸºäºæ–‡ä»¶æ—¶é—´+1åˆ†é’Ÿï¼‰
        function resetCountdown(fileTimeStr) {
            if (!fileTimeStr) return;
            
            try {
                // æ–‡ä»¶æ—¶é—´+1åˆ†é’Ÿ
                const fileTime = new Date(fileTimeStr);
                fileTime.setMinutes(fileTime.getMinutes() + 1);
                
                // ä¸‹æ¬¡æ›´æ–°æ—¶é—´ = æ–‡ä»¶æ—¶é—´+1åˆ†é’Ÿ + 10åˆ†é’Ÿ
                const nextUpdate = new Date(fileTime.getTime() + 10 * 60 * 1000);
                const now = new Date();
                
                // è®¡ç®—å‰©ä½™ç§’æ•°
                let seconds = Math.max(0, Math.floor((nextUpdate - now) / 1000));
                
                console.log(`æ–‡ä»¶æ—¶é—´: ${fileTimeStr}`);
                console.log(`æ›´æ–°æ—¶é—´(+1åˆ†é’Ÿ): ${fileTime.toLocaleTimeString('zh-CN')}`);
                console.log(`ä¸‹æ¬¡æ›´æ–°: ${nextUpdate.toLocaleTimeString('zh-CN')}`);
                console.log(`å‰©ä½™ç§’æ•°: ${seconds}`);
                
                // é‡æ–°å¼€å§‹å€’è®¡æ—¶
                clearInterval(countdownInterval);
                
                function updateCountdown() {
                    const minutes = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    const display = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    document.getElementById('countdown-time').textContent = display;

                    if (seconds === 0) {
                        seconds = 600;  // é‡ç½®ä¸º10åˆ†é’Ÿ
                    } else {
                        seconds--;
                    }
                }
                
                updateCountdown();
                countdownInterval = setInterval(updateCountdown, 1000);
            } catch (error) {
                console.error('é‡ç½®å€’è®¡æ—¶å¤±è´¥:', error);
            }
        }
    </script>
</body>
</html>
