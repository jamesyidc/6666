<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†å²æ•°æ®æŸ¥è¯¢ - åŠ å¯†è´§å¸è¯„åˆ†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .nav-btn {
            background: rgba(255,255,255,0.25);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.35);
            transform: scale(1.05);
        }

        .date-selector {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            color: white;
        }

        .date-selector h3 {
            margin-bottom: 15px;
        }

        .date-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .date-item {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .date-item:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .date-item.active {
            background: rgba(255,255,255,0.4);
            border: 2px solid white;
        }

        .statistics-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 25px;
        }

        .panel-title {
            font-size: 1.8em;
            margin-bottom: 25px;
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .time-label {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .stat-card .score-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.95em;
        }

        .stat-card .score-value {
            font-weight: bold;
        }

        .stat-card .diff-row {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.3);
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .diff-positive {
            color: #4ade80;
        }

        .diff-negative {
            color: #f87171;
        }

        .trend-icon {
            font-size: 1.3em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2em;
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .date-list {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“… å†å²æ•°æ®æŸ¥è¯¢</h1>
            <div class="subtitle">åŠ å¯†è´§å¸è¯„åˆ†å†å²è®°å½•</div>
        </div>

        <div class="nav-buttons">
            <a href="/score" class="nav-btn">ğŸ“Š å®æ—¶è¯„åˆ†</a>
            <a href="/history" class="nav-btn" style="background: rgba(255,255,255,0.35);">ğŸ“… å†å²æ•°æ®</a>
        </div>

        <div class="date-selector">
            <h3>ğŸ“† é€‰æ‹©æ—¥æœŸ</h3>
            <div id="dateList" class="date-list">
                <div class="loading">åŠ è½½æ—¥æœŸåˆ—è¡¨...</div>
            </div>
        </div>

        <div class="statistics-panel" id="statisticsPanel" style="display:none;">
            <h2 class="panel-title" id="panelTitle">ğŸ“ˆ å„æ—¶é—´æ®µå¹³å‡å¾—åˆ†ç»Ÿè®¡</h2>
            <div id="statsGrid" class="stats-grid">
                <div class="loading">è¯·é€‰æ‹©æ—¥æœŸ...</div>
            </div>
        </div>
    </div>

    <script>
        // APIé…ç½®
        const API_BASE = window.location.origin;
        const DATES_API = `${API_BASE}/api/history/dates`;
        const HISTORY_API = `${API_BASE}/api/history`;

        // æ—¶é—´èŒƒå›´æ ‡ç­¾
        const TIME_LABELS = {
            '3m': '3åˆ†é’Ÿ',
            '1h': '1å°æ—¶',
            '3h': '3å°æ—¶',
            '6h': '6å°æ—¶',
            '12h': '12å°æ—¶',
            '24h': '24å°æ—¶'
        };

        let selectedDate = null;

        // åŠ è½½æ—¥æœŸåˆ—è¡¨
        async function loadDates() {
            try {
                const response = await fetch(`${DATES_API}?days=30`);
                const data = await response.json();

                if (data.dates && data.dates.length > 0) {
                    renderDateList(data.dates);
                } else {
                    document.getElementById('dateList').innerHTML = 
                        '<div class="no-data">æš‚æ— å†å²æ•°æ®</div>';
                }
            } catch (error) {
                console.error('åŠ è½½æ—¥æœŸåˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('dateList').innerHTML = 
                    '<div class="error">åŠ è½½æ—¥æœŸåˆ—è¡¨å¤±è´¥</div>';
            }
        }

        // æ¸²æŸ“æ—¥æœŸåˆ—è¡¨
        function renderDateList(dates) {
            const html = dates.map(date => {
                // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
                const dateObj = new Date(date);
                const display = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
                
                return `
                    <div class="date-item" onclick="selectDate('${date}')">
                        <div style="font-size: 0.9em; opacity: 0.8;">${dateObj.getFullYear()}</div>
                        <div style="font-size: 1.2em; font-weight: bold;">${display}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('dateList').innerHTML = html;
        }

        // é€‰æ‹©æ—¥æœŸ
        async function selectDate(date) {
            selectedDate = date;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.date-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // åŠ è½½è¯¥æ—¥æœŸçš„æ•°æ®
            await loadHistoryData(date);
        }

        // åŠ è½½å†å²æ•°æ®
        async function loadHistoryData(date) {
            const panel = document.getElementById('statisticsPanel');
            const grid = document.getElementById('statsGrid');
            const title = document.getElementById('panelTitle');
            
            panel.style.display = 'block';
            grid.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            try {
                const response = await fetch(`${HISTORY_API}/${date}`);
                const data = await response.json();

                if (data.statistics && data.statistics.length > 0) {
                    const dateObj = new Date(date);
                    title.textContent = `ğŸ“ˆ ${dateObj.getFullYear()}å¹´${dateObj.getMonth() + 1}æœˆ${dateObj.getDate()}æ—¥ å„æ—¶é—´æ®µç»Ÿè®¡`;
                    
                    if (data.update_time) {
                        title.textContent += ` (æ›´æ–°æ—¶é—´: ${data.update_time})`;
                    }
                    
                    renderStatistics(data.statistics);
                } else {
                    grid.innerHTML = '<div class="no-data">è¯¥æ—¥æœŸæš‚æ— æ•°æ®</div>';
                }
            } catch (error) {
                console.error('åŠ è½½å†å²æ•°æ®å¤±è´¥:', error);
                grid.innerHTML = '<div class="error">åŠ è½½æ•°æ®å¤±è´¥</div>';
            }
        }

        // æ¸²æŸ“ç»Ÿè®¡å¡ç‰‡
        function renderStatistics(stats) {
            const html = stats.map(stat => {
                const diffClass = stat.avg_diff >= 0 ? 'diff-positive' : 'diff-negative';
                const trendIcon = stat.avg_diff >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
                
                return `
                    <div class="stat-card">
                        <div class="time-label">${TIME_LABELS[stat.time_range] || stat.time_range}</div>
                        <div class="score-row">
                            <span>å¹³å‡åšå¤šå¾—åˆ†:</span>
                            <span class="score-value">${stat.avg_long_score}</span>
                        </div>
                        <div class="score-row">
                            <span>å¹³å‡åšç©ºå¾—åˆ†:</span>
                            <span class="score-value">${stat.avg_short_score}</span>
                        </div>
                        <div class="diff-row">
                            <span>å¹³å‡å·®å€¼:</span>
                            <span class="score-value ${diffClass}">
                                ${stat.avg_diff > 0 ? '+' : ''}${stat.avg_diff}
                            </span>
                            <span class="trend-icon">${trendIcon}</span>
                        </div>
                        <div class="score-row" style="margin-top: 10px; opacity: 0.8; font-size: 0.9em;">
                            <span>å¸ç§æ•°é‡:</span>
                            <span>${stat.coin_count}</span>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('statsGrid').innerHTML = html;
        }

        // åˆå§‹åŠ è½½
        window.addEventListener('load', () => {
            loadDates();
        });
    </script>
</body>
</html>
