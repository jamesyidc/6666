<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ å¯†è´§å¸å¾—åˆ†ç³»ç»Ÿ V1.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .update-info {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .update-time {
            font-size: 0.95em;
        }

        .refresh-btn {
            background: rgba(255,255,255,0.25);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .refresh-btn:hover {
            background: rgba(255,255,255,0.35);
            transform: scale(1.05);
        }

        .refresh-btn:active {
            transform: scale(0.95);
        }

        .statistics-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 25px;
        }

        .panel-title {
            font-size: 1.8em;
            margin-bottom: 25px;
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .time-label {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .stat-card .score-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.95em;
        }

        .stat-card .score-value {
            font-weight: bold;
        }

        .stat-card .diff-row {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.3);
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .diff-positive {
            color: #4ade80;
        }

        .diff-negative {
            color: #f87171;
        }

        .trend-icon {
            font-size: 1.3em;
        }

        .table-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead tr {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 0.95em;
        }

        td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
        }

        tbody tr:hover {
            background: #f9fafb;
        }

        .coin-symbol {
            font-weight: bold;
            color: #667eea;
        }

        .score-cell {
            font-size: 0.9em;
        }

        .score-long {
            color: #10b981;
        }

        .score-short {
            color: #ef4444;
        }

        .score-diff {
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2em;
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .update-info {
                flex-direction: column;
                gap: 10px;
            }

            table {
                font-size: 0.85em;
            }

            th, td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š åŠ å¯†è´§å¸å¾—åˆ†ç³»ç»Ÿ</h1>
            <div class="subtitle">å¤šæ—¶é—´èŒƒå›´åšå¤š/åšç©ºè¯„åˆ†ç»Ÿè®¡åˆ†æ</div>
        </div>

        <div class="update-info">
            <div class="update-time">
                â° æœ€åæ›´æ–°: <span id="updateTime">åŠ è½½ä¸­...</span>
            </div>
            <button class="refresh-btn" onclick="refreshData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
        </div>

        <div class="statistics-panel">
            <h2 class="panel-title">ğŸ“ˆ å„æ—¶é—´æ®µå¹³å‡å¾—åˆ†ç»Ÿè®¡</h2>
            <div id="statsGrid" class="stats-grid">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <div class="table-container">
            <h2 class="panel-title">ğŸ’° å„å¸ç§è¯¦ç»†å¾—åˆ†</h2>
            <div id="coinsTable">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        // APIé…ç½®
        const API_BASE = window.location.origin;
        const STATS_API = `${API_BASE}/api/score/statistics`;
        const COINS_API = `${API_BASE}/api/score/coins`;
        const REFRESH_API = `${API_BASE}/api/score/refresh`;

        // æ—¶é—´èŒƒå›´æ ‡ç­¾
        const TIME_LABELS = {
            '3m': '3åˆ†é’Ÿ',
            '1h': '1å°æ—¶',
            '3h': '3å°æ—¶',
            '6h': '6å°æ—¶',
            '12h': '12å°æ—¶',
            '24h': '24å°æ—¶'
        };

        // åŠ è½½ç»Ÿè®¡æ•°æ®
        async function loadStatistics() {
            try {
                const response = await fetch(STATS_API);
                const data = await response.json();

                if (data.update_time) {
                    document.getElementById('updateTime').textContent = data.update_time;
                }

                if (data.statistics && data.statistics.length > 0) {
                    renderStatistics(data.statistics);
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                document.getElementById('statsGrid').innerHTML = 
                    '<div class="error">åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥</div>';
            }
        }

        // æ¸²æŸ“ç»Ÿè®¡å¡ç‰‡
        function renderStatistics(stats) {
            const html = stats.map(stat => {
                const diffClass = stat.avg_diff >= 0 ? 'diff-positive' : 'diff-negative';
                const trendIcon = stat.avg_diff >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
                
                return `
                    <div class="stat-card">
                        <div class="time-label">${TIME_LABELS[stat.time_range] || stat.time_range}</div>
                        <div class="score-row">
                            <span>å¹³å‡åšå¤šå¾—åˆ†:</span>
                            <span class="score-value">${stat.avg_long_score}</span>
                        </div>
                        <div class="score-row">
                            <span>å¹³å‡åšç©ºå¾—åˆ†:</span>
                            <span class="score-value">${stat.avg_short_score}</span>
                        </div>
                        <div class="diff-row">
                            <span>å¹³å‡å·®å€¼:</span>
                            <span class="score-value ${diffClass}">
                                ${stat.avg_diff > 0 ? '+' : ''}${stat.avg_diff}
                            </span>
                            <span class="trend-icon">${trendIcon}</span>
                        </div>
                        <div class="score-row" style="margin-top: 10px; opacity: 0.8; font-size: 0.9em;">
                            <span>å¸ç§æ•°é‡:</span>
                            <span>${stat.coin_count}</span>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('statsGrid').innerHTML = html;
        }

        // åŠ è½½å¸ç§æ•°æ®
        async function loadCoins() {
            try {
                const response = await fetch(COINS_API);
                const data = await response.json();

                if (Object.keys(data).length > 0) {
                    renderCoinsTable(data);
                }
            } catch (error) {
                console.error('åŠ è½½å¸ç§æ•°æ®å¤±è´¥:', error);
                document.getElementById('coinsTable').innerHTML = 
                    '<div class="error">åŠ è½½å¸ç§æ•°æ®å¤±è´¥</div>';
            }
        }

        // æ¸²æŸ“å¸ç§è¡¨æ ¼
        function renderCoinsTable(coins) {
            const timeRanges = ['3m', '1h', '3h', '6h', '12h', '24h'];
            
            let html = '<table><thead><tr><th rowspan="2">å¸ç§</th>';
            
            // è¡¨å¤´
            timeRanges.forEach(range => {
                html += `<th colspan="3">${TIME_LABELS[range]}</th>`;
            });
            html += '</tr><tr>';
            timeRanges.forEach(() => {
                html += '<th>åšå¤š</th><th>åšç©º</th><th>å·®å€¼</th>';
            });
            html += '</tr></thead><tbody>';

            // æ•°æ®è¡Œ
            Object.keys(coins).sort().forEach(symbol => {
                const coinName = symbol.replace('-USDT-SWAP', '');
                html += `<tr><td class="coin-symbol">${coinName}</td>`;
                
                timeRanges.forEach(range => {
                    const data = coins[symbol][range];
                    if (data) {
                        const diffClass = data.diff >= 0 ? 'diff-positive' : 'diff-negative';
                        html += `
                            <td class="score-cell score-long">${data.long_score}</td>
                            <td class="score-cell score-short">${data.short_score}</td>
                            <td class="score-cell score-diff ${diffClass}">
                                ${data.diff > 0 ? '+' : ''}${data.diff}
                            </td>
                        `;
                    } else {
                        html += '<td colspan="3">-</td>';
                    }
                });
                
                html += '</tr>';
            });

            html += '</tbody></table>';
            document.getElementById('coinsTable').innerHTML = html;
        }

        // åˆ·æ–°æ•°æ®
        async function refreshData() {
            const btn = document.querySelector('.refresh-btn');
            btn.disabled = true;
            btn.textContent = 'â³ åˆ·æ–°ä¸­...';

            try {
                const response = await fetch(REFRESH_API);
                const result = await response.json();

                if (result.success) {
                    await loadStatistics();
                    await loadCoins();
                    btn.textContent = 'âœ… åˆ·æ–°æˆåŠŸ';
                    setTimeout(() => {
                        btn.textContent = 'ğŸ”„ åˆ·æ–°æ•°æ®';
                        btn.disabled = false;
                    }, 2000);
                } else {
                    btn.textContent = 'âŒ åˆ·æ–°å¤±è´¥';
                    setTimeout(() => {
                        btn.textContent = 'ğŸ”„ åˆ·æ–°æ•°æ®';
                        btn.disabled = false;
                    }, 2000);
                }
            } catch (error) {
                console.error('åˆ·æ–°å¤±è´¥:', error);
                btn.textContent = 'âŒ åˆ·æ–°å¤±è´¥';
                setTimeout(() => {
                    btn.textContent = 'ğŸ”„ åˆ·æ–°æ•°æ®';
                    btn.disabled = false;
                }, 2000);
            }
        }

        // åˆå§‹åŠ è½½
        window.addEventListener('load', () => {
            loadStatistics();
            loadCoins();

            // æ¯3åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°
            setInterval(() => {
                loadStatistics();
                loadCoins();
            }, 180000);
        });
    </script>
</body>
</html>
