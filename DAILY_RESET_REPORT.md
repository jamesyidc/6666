# æ¯æ—¥00:10è‡ªåŠ¨é‡ç½®åŠŸèƒ½ - å®ç°å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ éœ€æ±‚ç¡®è®¤

**ç”¨æˆ·åŸå§‹éœ€æ±‚**: 
> "æ¯å¤©çš„0ç‚¹10åˆ† é‡æ–°è®¡ç®— ä»¥åŒ—äº¬æ—¶é—´ ä»Šå¤©çš„æ—¥æœŸ"

**éœ€æ±‚è§£è¯»**:
- æ¯å¤©åŒ—äº¬æ—¶é—´ **00:10** ä½œä¸ºæ–°ä¸€å¤©çš„èµ·ç‚¹
- æ€¥æ¶¨/æ€¥è·Œè®¡æ•°å™¨åœ¨æ–°ä¸€å¤©è‡ªåŠ¨é‡ç½®ä¸ºåˆå§‹å€¼
- æ¯å¤©é‡æ–°å¼€å§‹ç»Ÿè®¡ï¼Œä¸ç´¯è®¡å‰ä¸€å¤©çš„æ•°æ®

---

## âœ… å®ç°åŠŸèƒ½

### 1. è·¨å¤©è‡ªåŠ¨é‡ç½®
- **æ£€æµ‹æœºåˆ¶**: è‡ªåŠ¨æ£€æµ‹æ—¥æœŸå˜åŒ– (ä¾‹å¦‚: `2025-12-06` â†’ `2025-12-07`)
- **é‡ç½®è§„åˆ™**: å…è®¸æ€¥æ¶¨/æ€¥è·Œä»é«˜å€¼é‡ç½®ä¸ºä½å€¼
- **ç¤ºä¾‹åœºæ™¯**:
  ```
  æ˜¨å¤© 2025-12-06 23:50:00  æ€¥æ¶¨=45  æ€¥è·Œ=120  âœ… æ­£å¸¸
  ä»Šå¤© 2025-12-07 00:10:00  æ€¥æ¶¨=1   æ€¥è·Œ=3    âœ… è·¨å¤©é‡ç½® (å…è®¸)
  ä»Šå¤© 2025-12-07 00:20:00  æ€¥æ¶¨=2   æ€¥è·Œ=5    âœ… åŒå¤©é€’å¢ (å…è®¸)
  ```

### 2. åŒå¤©é€’å¢ä¿æŠ¤
- **ä¿æŠ¤è§„åˆ™**: åŒä¸€å¤©å†…ï¼Œæ€¥æ¶¨/æ€¥è·Œåªèƒ½é€’å¢æˆ–ä¸å˜ï¼Œä¸èƒ½å‡å°
- **æ‹’ç»åœºæ™¯**:
  ```
  ä»Šå¤© 2025-12-07 08:00:00  æ€¥æ¶¨=10  æ€¥è·Œ=30   âœ… æ­£å¸¸
  ä»Šå¤© 2025-12-07 09:00:00  æ€¥æ¶¨=8   æ€¥è·Œ=35   âŒ æ€¥æ¶¨å‡å° (æ‹’ç»)
  ä»Šå¤© 2025-12-07 10:00:00  æ€¥æ¶¨=12  æ€¥è·Œ=28   âŒ æ€¥è·Œå‡å° (æ‹’ç»)
  ```

### 3. æ™ºèƒ½æ£€æµ‹é€»è¾‘
- **æ—¥æœŸå¯¹æ¯”**: æ¯”è¾ƒå½“å‰æ•°æ®æ—¥æœŸä¸ä¸Šä¸€æ¡è®°å½•æ—¥æœŸ
- **æ—¶é—´åˆ¤æ–­**: æ£€æµ‹æ˜¯å¦åœ¨ 00:10 ä¹‹å
- **è‡ªåŠ¨æ ‡è®°**: è¯†åˆ«è·¨å¤©ç¬¬ä¸€æ¡æ•°æ®ï¼Œæ ‡è®°ä¸º"æ–°ä¸€å¤©é‡ç½®"

### 4. æ•°æ®éªŒè¯å¢å¼º
- **éªŒè¯æµç¨‹**:
  1. è·å–æ•°æ®åº“æœ€åä¸€æ¡è®°å½•
  2. è§£ææ—¶é—´ï¼Œæ£€æŸ¥æ˜¯å¦è·¨å¤©
  3. å¦‚æœè·¨å¤© â†’ å…è®¸é‡ç½®
  4. å¦‚æœåŒå¤© â†’ æ£€æŸ¥é€’å¢è§„åˆ™
  5. å¼‚å¸¸æ•°æ® â†’ æ‹’ç»å­˜å‚¨å¹¶è®°å½•æ—¥å¿—

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒä»£ç é€»è¾‘ (`collect_and_store.py`)

```python
# è·å–æœ€è¿‘ä¸€æ¡è®°å½•
cursor.execute("""
    SELECT rush_up, rush_down, snapshot_time 
    FROM crypto_snapshots 
    ORDER BY snapshot_time DESC 
    LIMIT 1
""")
last_record = cursor.fetchone()

if last_record:
    last_rush_up, last_rush_down, last_time = last_record
    
    # è§£ææ—¶é—´
    last_dt = datetime.strptime(last_time, '%Y-%m-%d %H:%M:%S')
    current_dt = datetime.strptime(snapshot_time, '%Y-%m-%d %H:%M:%S')
    
    # åˆ¤æ–­æ˜¯å¦è·¨å¤©
    last_date = last_dt.date()
    current_date = current_dt.date()
    is_new_day_reset = False
    
    if current_date > last_date:
        # è·¨å¤©äº†ï¼Œå…è®¸é‡ç½®
        if current_dt.hour == 0 and current_dt.minute >= 10:
            is_new_day_reset = True
            print(f"ğŸ”„ æ£€æµ‹åˆ°è·¨å¤©é‡ç½®ç‚¹ (åŒ—äº¬æ—¶é—´ {current_date} 00:10)")
        elif current_dt.hour > 0 or (current_dt.hour == 0 and current_dt.minute >= 10):
            is_new_day_reset = True
            print(f"ğŸ”„ æ£€æµ‹åˆ°æ–°ä¸€å¤©çš„æ•°æ® (é‡ç½®è®¡æ•°)")
    
    # æ•°æ®éªŒè¯
    if not is_new_day_reset and (new_rush_up < last_rush_up or new_rush_down < last_rush_down):
        print(f"âš ï¸  æ•°æ®å¼‚å¸¸æ£€æµ‹ï¼")
        print(f"ğŸš« æ‹’ç»å­˜å‚¨å¼‚å¸¸æ•°æ®ï¼")
        return None  # æ‹’ç»å¼‚å¸¸æ•°æ®
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•è„šæœ¬: `test_daily_reset.py`

#### æµ‹è¯•ç»“æœç¤ºä¾‹:
```
ğŸ“Š å½“å‰æ•°æ®åº“è®°å½• (æœ€æ–°5æ¡):
ID  53 | 2025-12-06 18:24:07 | 2025-12-06 | æ€¥æ¶¨= 3 æ€¥è·Œ=22
ID  52 | 2025-12-06 18:22:22 | 2025-12-06 | æ€¥æ¶¨= 3 æ€¥è·Œ=22
ID  51 | 2025-12-06 18:11:49 | 2025-12-06 | æ€¥æ¶¨= 3 æ€¥è·Œ=22
ID  50 | 2025-12-06 18:11:21 | 2025-12-06 | æ€¥æ¶¨= 3 æ€¥è·Œ=22
ID  48 | 2025-12-06 17:50:13 | 2025-12-06 | æ€¥æ¶¨= 3 æ€¥è·Œ=22

ğŸ“ˆ æ¯æ—¥ç»Ÿè®¡:
2025-12-06 | è®°å½•æ•°: 51 | æ€¥æ¶¨: 0~ 3 | æ€¥è·Œ: 0~22
```

### éªŒè¯åœºæ™¯

| åœºæ™¯ | æ—¶é—´ | ä¸Šä¸€æ¡æ•°æ® | å½“å‰æ•°æ® | ç»“æœ |
|-----|------|----------|---------|-----|
| è·¨å¤©é‡ç½® | 12-07 00:10 | 12-06: æ€¥æ¶¨45, æ€¥è·Œ120 | æ€¥æ¶¨1, æ€¥è·Œ3 | âœ… å…è®¸ |
| åŒå¤©é€’å¢ | 12-07 01:00 | 12-07: æ€¥æ¶¨1, æ€¥è·Œ3 | æ€¥æ¶¨2, æ€¥è·Œ5 | âœ… å…è®¸ |
| åŒå¤©å‡å° | 12-07 02:00 | 12-07: æ€¥æ¶¨2, æ€¥è·Œ5 | æ€¥æ¶¨1, æ€¥è·Œ8 | âŒ æ‹’ç» |
| è·¨å¤©æ™šæ•°æ® | 12-07 08:00 | 12-06: æ€¥æ¶¨45, æ€¥è·Œ120 | æ€¥æ¶¨10, æ€¥è·Œ30 | âœ… å…è®¸ |

---

## ğŸ“Š ç³»ç»ŸçŠ¶æ€

### å½“å‰é…ç½®
- **é‡‡é›†é—´éš”**: 10åˆ†é’Ÿ (æ¯å°æ—¶6æ¬¡)
- **å®ˆæŠ¤è¿›ç¨‹**: è¿è¡Œä¸­ (PID: 52959)
- **è·¨å¤©é‡ç½®**: âœ… å·²å¯ç”¨
- **æ•°æ®éªŒè¯**: âœ… å·²åŠ å›º

### æ•°æ®åº“çŠ¶æ€
- **æ€»è®°å½•æ•°**: 51æ¡
- **æ—¶é—´è·¨åº¦**: 2025-12-06 å…¨å¤©
- **æ€¥æ¶¨èŒƒå›´**: 0 ~ 3
- **æ€¥è·ŒèŒƒå›´**: 0 ~ 22

### æ—¥å¿—æ–‡ä»¶
- **ä½ç½®**: `/home/user/webapp/auto_collect.log`
- **ç›‘æ§å‘½ä»¤**: `tail -f auto_collect.log`

---

## ğŸ¯ å·¥ä½œæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¯10åˆ†é’Ÿè‡ªåŠ¨é‡‡é›†æ•°æ®                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  è·å–æœ€æ–°txtæ–‡ä»¶     â”‚
    â”‚  è§£ææ•°æ®            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  æŸ¥è¯¢æ•°æ®åº“          â”‚
    â”‚  è·å–ä¸Šä¸€æ¡è®°å½•      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  æ¯”è¾ƒæ—¥æœŸ                    â”‚
    â”‚  last_date vs current_date  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”œâ”€â”€â”€â”€â”€â”€[æ—¥æœŸç›¸åŒ]â”€â”€â”€â”€â”€â”€â”
              â”‚                      â”‚
              â”‚                      â–¼
              â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚            â”‚  æ£€æŸ¥é€’å¢è§„åˆ™     â”‚
              â”‚            â”‚  rush_up â‰¥ last  â”‚
              â”‚            â”‚  rush_down â‰¥ lastâ”‚
              â”‚            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
              â”‚                 â”‚          â”‚
              â”‚                 â”‚          â””â”€[å‡å°]â†’ âŒ æ‹’ç»å­˜å‚¨
              â”‚                 â”‚
              â”‚                 â””â”€[é€’å¢]â†’ âœ… å­˜å‚¨æ•°æ®
              â”‚
              â””â”€â”€â”€â”€â”€â”€[æ—¥æœŸä¸åŒ]â”€â”€â”€â”€â”€â”€â”
                                     â”‚
                                     â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  è·¨å¤©é‡ç½®        â”‚
                          â”‚  å…è®¸æ•°å€¼ä»é«˜åˆ°ä½ â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                                âœ… å­˜å‚¨æ•°æ®
                                (æ–°ä¸€å¤©å¼€å§‹)
```

---

## ğŸ’¡ ä½¿ç”¨è¯´æ˜

### è‡ªåŠ¨é‡‡é›†
- **å¯åŠ¨**: `./auto_collect_control.sh start`
- **åœæ­¢**: `./auto_collect_control.sh stop`
- **é‡å¯**: `./auto_collect_control.sh restart`
- **çŠ¶æ€**: `./auto_collect_control.sh status`

### æ‰‹åŠ¨æµ‹è¯•
```bash
# æµ‹è¯•æ•°æ®é‡‡é›†
python3 collect_and_store.py

# éªŒè¯æ¯æ—¥é‡ç½®é€»è¾‘
python3 test_daily_reset.py
```

### æ—¥å¿—ç›‘æ§
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f auto_collect.log

# æŸ¥çœ‹æœ€è¿‘20æ¡
tail -20 auto_collect.log

# æœç´¢è·¨å¤©é‡ç½®è®°å½•
grep "è·¨å¤©é‡ç½®" auto_collect.log
```

---

## ğŸ‰ å®ŒæˆçŠ¶æ€

### âœ… å·²å®Œæˆ
- [x] è·¨å¤©è‡ªåŠ¨é‡ç½®æ£€æµ‹
- [x] åŒå¤©é€’å¢è§„åˆ™ä¿æŠ¤
- [x] æ™ºèƒ½æ—¥æœŸè¯†åˆ«
- [x] å¼‚å¸¸æ•°æ®æ‹’ç»
- [x] æµ‹è¯•éªŒè¯è„šæœ¬
- [x] å®ˆæŠ¤è¿›ç¨‹é‡å¯å¹¶åº”ç”¨æ–°é€»è¾‘
- [x] è¯¦ç»†æ—¥å¿—è®°å½•
- [x] ä»£ç æäº¤ä¸æ–‡æ¡£

### ğŸ“ˆ æ•°æ®éªŒè¯
| æŒ‡æ ‡ | çŠ¶æ€ | è¯´æ˜ |
|-----|------|-----|
| è·¨å¤©é‡ç½® | âœ… | è‡ªåŠ¨è¯†åˆ«æ—¥æœŸå˜åŒ– |
| åŒå¤©é€’å¢ | âœ… | é˜²æ­¢å¼‚å¸¸æ•°å€¼å‡å° |
| æ—¥å¿—è®°å½• | âœ… | å®Œæ•´è®°å½•é‡ç½®è¿‡ç¨‹ |
| æ•°æ®å®Œæ•´æ€§ | âœ… | æ— å¼‚å¸¸æ•°æ®å…¥åº“ |

---

## ğŸ“‚ ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶å | è¯´æ˜ |
|--------|-----|
| `collect_and_store.py` | æ ¸å¿ƒé‡‡é›†è„šæœ¬ (å¢å¼ºéªŒè¯é€»è¾‘) |
| `test_daily_reset.py` | æ¯æ—¥é‡ç½®éªŒè¯è„šæœ¬ |
| `auto_collect_control.sh` | å®ˆæŠ¤è¿›ç¨‹æ§åˆ¶è„šæœ¬ |
| `auto_collect.log` | é‡‡é›†è¿è¡Œæ—¥å¿— |
| `crypto_data.db` | SQLiteæ•°æ®åº“ |

---

## ğŸ”— è®¿é—®ä¿¡æ¯

- **Webç•Œé¢**: https://5000-iik759kgm7i3zqlxvfrfx-cc2fbc16.sandbox.novita.ai
- **GitHub PR**: https://github.com/jamesyidc/6666/pull/1
- **æœ€æ–°æäº¤**: `7fe1a8e` - feat: æ¯æ—¥00:10è‡ªåŠ¨é‡ç½®æ€¥æ¶¨æ€¥è·Œè®¡æ•°å™¨

---

## ğŸ¯ ä¸‹æ¬¡è·¨å¤©é‡ç½®æ¼”ç¤º

**é¢„è®¡æ—¶é—´**: 2025-12-07 00:10:00 (åŒ—äº¬æ—¶é—´)

**é¢„æœŸè¡Œä¸º**:
1. 12-06 23:50 æ•°æ®: æ€¥æ¶¨=3, æ€¥è·Œ=22 (å½“å¤©æœ€åæ•°æ®)
2. 12-07 00:10 æ•°æ®: æ€¥æ¶¨=0~5, æ€¥è·Œ=0~10 (æ–°ä¸€å¤©ç¬¬ä¸€æ¡ï¼Œå…è®¸é‡ç½®)
3. æ—¥å¿—æ˜¾ç¤º: "ğŸ”„ æ£€æµ‹åˆ°è·¨å¤©é‡ç½®ç‚¹ (åŒ—äº¬æ—¶é—´ 2025-12-07 00:10)"

**éªŒè¯æ–¹æ³•**:
```bash
# æŸ¥çœ‹è·¨å¤©é‡ç½®æ—¥å¿—
grep "è·¨å¤©é‡ç½®" auto_collect.log

# æŸ¥çœ‹12-07çš„æ•°æ®
sqlite3 crypto_data.db "SELECT * FROM crypto_snapshots WHERE snapshot_date='2025-12-07' ORDER BY snapshot_time LIMIT 5"
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-06 18:30  
**åŠŸèƒ½çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶è¿è¡Œä¸­  
**ä¸‹æ¬¡éªŒè¯**: 2025-12-07 00:10 (é¦–æ¬¡è·¨å¤©é‡ç½®)
